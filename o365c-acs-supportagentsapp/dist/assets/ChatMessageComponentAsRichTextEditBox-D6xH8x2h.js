import{r as t,g as oe,B as se,a as re,b as ie,R as i,u as le,c as ce,i as de,d as N,e as me,f as ue,h as ge,j as he,m as w,o as pe,k as xe,l as Ie,n as Ce,p as Ee,S as D,q as be,s as Se,t as B,I as V,v as K,w as Be,F as fe,_ as ye,C as ve,x as z,y as Me,z as Te,A as Ae,D as Re,E as Pe}from"./index-CYIswHfQ.js";const ke=F=>{var x;const{onCancel:I,onSubmit:f,strings:a,message:o,onPaste:H,onInsertInlineImage:y,inlineImagesWithProgress:l,onRemoveInlineImage:C}=F,[g,j]=t.useState([]),v=t.useMemo(()=>{const e=o.content;j(oe(e));const n=new DOMParser().parseFromString(e??"","text/html");return n.querySelectorAll(".broken-image-wrapper").forEach(s=>{var r;const m=n.createElement("img"),ae=s.attributes;for(const O of ae)m.setAttribute(O.name,O.value);m.src=se,m.style.width="3rem",m.style.height="3rem",(r=s.parentElement)===null||r===void 0||r.replaceChild(m,s)}),n.body.innerHTML},[o]),[d,q]=t.useState(v||""),[M,G]=t.useState(!1),[c,J]=t.useReducer(re,(x=ie(o))!==null&&x!==void 0?x:[]),[Q,T]=t.useState(void 0),E=i.useRef(null),u=le(),h=t.useMemo(()=>{var e,n;const s=(n=(e=E.current)===null||e===void 0?void 0:e.getPlainContent())!==null&&n!==void 0?n:d;let r=ce(s,c??[]);const m=de(d);return r!=="OK"&&m.length>0&&(N(d.length)?r="too long":r="OK"),r},[c,d]),A=t.useMemo(()=>{var e,n;return(n=(e=l==null?void 0:l.filter(s=>s.error).pop())===null||e===void 0?void 0:e.error)===null||n===void 0?void 0:n.message},[l]),R=me(),P=ue(),b=ge().strings,U=t.useCallback(e=>{q(e??"")},[]);t.useEffect(()=>{var e;(e=E.current)===null||e===void 0||e.focus()},[]);const X=t.useMemo(()=>he(h,a.editBoxTextLimit,a.editBoxEmptyWarningText,M),[h,a.editBoxTextLimit,a.editBoxEmptyWarningText,M]),p=t.useCallback(e=>{const n=e?u.palette.accent:u.palette.neutralSecondary;return w(Re,{color:n})},[u.palette.accent,u.palette.neutralSecondary]),k=t.useCallback(e=>pe(p(e)),[p]),_=t.useCallback(e=>xe(p(e)),[p]),Y=t.useMemo(()=>Ie(o),[o]),S=t.useCallback(()=>{if(h!=="OK")return;if(l&&l.length>0){const s=Ce(d,l),r=N(s.length);if(G(r),r)return}if(T(void 0),Ee(l)){T({message:a.imageUploadsPendingError,timestamp:Date.now(),errorBarType:D.info});return}let e=d;e=be(e);let n=[];n=g??[],Se(e,n,s=>{f(s,c||[])})},[h,l,g,d,a.imageUploadsPendingError,f,c]),Z=t.useMemo(()=>i.createElement(B,{horizontal:!0},i.createElement(V,{className:K,ariaLabel:a.editBoxCancelButton,tooltipContent:a.editBoxCancelButton,onRenderIcon:k,onClick:()=>{I&&I(o.messageId)},id:"dismissIconWrapper","data-testId":"chat-message-rich-text-edit-box-cancel-button"}),i.createElement(V,{className:K,ariaLabel:a.editBoxSubmitButton,tooltipContent:a.editBoxSubmitButton,onRenderIcon:_,onClick:e=>{S(),e.stopPropagation()},id:"submitIconWrapper","data-testId":"chat-message-rich-text-edit-box-submit-button"})),[o.messageId,I,k,_,a.editBoxCancelButton,a.editBoxSubmitButton,S]),$=t.useMemo(()=>Object.assign(Object.assign({},b.richTextSendBox),a),[b.richTextSendBox,a,b.sendBox]),L=t.useCallback(e=>{J({type:"remove",id:e})},[]),ee=t.useCallback(()=>i.createElement(B,{className:Be},i.createElement(fe,{v8Theme:u},i.createElement(ye,{attachments:c,onCancelAttachmentUpload:L}))),[c,L,u]),te=t.useCallback((e,n)=>{n==null||n.forEach(s=>{C&&C(s,o.messageId)}),U(e)},[U,C,o.messageId]),ne=()=>i.createElement(B,{className:w(Pe)},i.createElement(Me,{textValidationErrorMessage:X,systemMessage:o.failureReason,attachmentUploadsPendingError:Q,attachmentProgressError:A?{message:A,timestamp:Date.now(),errorBarType:D.error}:void 0}),i.createElement(Te,{placeholderText:a.editBoxPlaceholderText,onChange:te,onEnterKeyDown:S,editorComponentRef:E,initialContent:v,strings:$,disabled:!1,actionComponents:Z,richTextEditorStyleProps:Ae,isHorizontalLayoutDisabled:!0,onRenderAttachmentUploads:ee,onPaste:H,onInsertInlineImage:y?e=>{y(e,o.messageId)}:void 0})),W=o.attached===!0?"center":o.attached==="bottom"?"bottom":"top";return i.createElement(ve,{attached:W,root:{className:z(P.root,Y?P.multipleAttachmentsInEditing:void 0)},body:{className:z(R.body,W!=="top"?R.bodyAttached:void 0)}},ne())};export{ke as ChatMessageComponentAsRichTextEditBox,ke as default};
